% Beamer theme for the University of Basel.
% Adapted from the SINTEF Beamer theme (Federico Zenith).

\ProvidesPackage{beamerthemeunibasel}[2026/01/06]

\RequirePackage{etoolbox}
\RequirePackage{tikz}
\RequirePackage{listings}

% Force 16:9 aspect ratio
\RequirePackage{geometry}
\geometry{paperwidth=16cm,paperheight=9cm}

% Caladea is a Cambria clone, Carlito a Calibri clone
\RequirePackage{caladea,carlito}
\renewcommand{\familydefault}{\sfdefault}

\RequirePackage{graphicx,unibaselcolor}

% No navigation symbols
\setbeamertemplate{navigation symbols}{}

% -----------------------------------------------------------------------------
% Footline
% -----------------------------------------------------------------------------
\newcommand{\@footlinepayoff}{\@UNIBASELmotto}
\setbeamertemplate{footline}{%
  \begin{beamercolorbox}[wd=\textwidth,ht=5mm,dp=3mm,rightskip=1cm]{footline}
  \usebeamerfont{footline}\hfill\@footlinepayoff
  \end{beamercolorbox}
}

% Coordinate blocks with footline colour
\newcommand{\footlinecolor}[1]{% if #1 is empty, makes footline transparent
  \ifstrempty{#1}{%
    \renewcommand{\@footlinepayoff}{}
    \setbeamercolor{footline}{bg=}
    \setbeamercolor{block title}{fg=unibasWhite,bg=unibasRed}
    \setbeamercolor{block body}{fg=unibasAnthracite,bg=unibasPaper}
  }{%
    \renewcommand{\@footlinepayoff}{\@UNIBASELmotto}
    \setbeamercolor{footline}{fg=unibasWhite,bg=#1}
    \setbeamercolor{block title}{fg=unibasWhite,bg=#1}
    \setbeamercolor{block body}{fg=unibasAnthracite,bg=unibasPaper}
  }%
}
\footlinecolor{} % Default: no footline

% -----------------------------------------------------------------------------
% Logos
% -----------------------------------------------------------------------------
\pgfdeclareimage[width=0.075\paperwidth]{unibaslogo}{images/unibas_logo_black}
\pgfdeclareimage[width=0.075\paperwidth]{unibaslogowhite}{images/unibas_logo_white}
\pgfdeclareimage[height=0.09\paperheight]{snsflogo}{images/SNSF_logo}
\newcommand{\@UNIBASELlogo}{unibaslogo}

% -----------------------------------------------------------------------------
% Theme switching
% -----------------------------------------------------------------------------
% NOTE: Beamer colors should be set in the preamble.
\newcommand{\themecolor}[1]{%
  % Usage: \themecolor{white} (default), \themecolor{mint}, \themecolor{red}
  %
  % Design note:
  % - Mint is very light in the Uni Basel palette, so we use it mainly as a
  %   *supporting* background tint, paired with Petrol/Turquoise for contrast.
  \ifstrequal{#1}{red}{%
    % Dark, brand-forward variant
    \setbeamercolor{normal text}{fg=unibasWhite,bg=unibasRed}
    \setbeamercolor{structure}{fg=unibasWhite}
    \renewcommand{\@UNIBASELlogo}{unibaslogowhite}

    \setbeamercolor{title}{fg=unibasWhite}
    \setbeamercolor{author}{fg=unibasWhite}
    \setbeamercolor{date}{fg=unibasWhite}
    \setbeamercolor{alerted text}{fg=unibasMint}

    \setbeamercolor{block title}{fg=unibasRed,bg=unibasWhite}
    \setbeamercolor{block body}{fg=unibasWhite,bg=unibasRed}
  }{%
    \ifstrequal{#1}{mint}{%
      % Mint variant (light, fresh, high-contrast)
      \setbeamercolor{normal text}{fg=unibasAnthracite,bg=unibasMint}
      \setbeamercolor{structure}{fg=unibasBlack}
      \renewcommand{\@UNIBASELlogo}{unibaslogo}

      \setbeamercolor{title}{fg=unibasBlack}
      \setbeamercolor{author}{fg=unibasBlack}
      \setbeamercolor{date}{fg=unibasBlack}
      \setbeamercolor{alerted text}{fg=unibasRed}

      % Blocks: strong header, soft mint body tint
      \setbeamercolor{block title}{fg=unibasWhite,bg=unibasTurquoise}
      \setbeamercolor{block body}{fg=unibasAnthracite,bg=unibasMint!15}
    }{%
      % Light, clean variant (default)
      \setbeamercolor{normal text}{fg=unibasAnthracite,bg=unibasWhite}
      \setbeamercolor{structure}{fg=unibasBlack}
      \renewcommand{\@UNIBASELlogo}{unibaslogo}

      \setbeamercolor{title}{fg=unibasBlack}
      \setbeamercolor{author}{fg=unibasBlack}
      \setbeamercolor{date}{fg=unibasBlack}
      \setbeamercolor{alerted text}{fg=unibasPetrol}

      \setbeamercolor{block title}{fg=unibasWhite,bg=unibasRed}
      \setbeamercolor{block body}{fg=unibasAnthracite,bg=unibasPaper}
    }%
  }%
}
\themecolor{white} % Default


% Typography
\setbeamerfont{author}{size=\scriptsize}
\setbeamerfont{date}{size=\tiny}
\setbeamerfont{title}{series=\bfseries}
\setbeamerfont{subtitle}{series=\mdseries,size=\footnotesize}
\setbeamerfont{frametitle}{series=\bfseries}
\setbeamerfont{framesubtitle}{series=\mdseries}
\setbeamerfont{footline}{size=\scriptsize}
\setbeamerfont{block title}{series=\centering, size=\small}
\setbeamerfont{block body}{size=\scriptsize}

% Prettier blocks
\setbeamertemplate{blocks}[rounded]

% Bullets
\setbeamertemplate{itemize item}{\textbullet}
\setbeamertemplate{itemize subitem}{\textemdash}
\setbeamertemplate{itemize subsubitem}{\ensuremath{\circ}}

\newenvironment{colorblock}[3][unibasWhite]{%
  \begingroup
  \setbeamercolor{block title}{fg=#1,bg=#2}
  \setbeamercolor{block body} {fg=#1,bg=#2}
  \begin{block}{#3}
}{%
  \end{block}
  \endgroup
}

% -----------------------------------------------------------------------------
% Headline: logo top-left
% -----------------------------------------------------------------------------
\setbeamertemplate{headline}{%
  \vspace{1.5mm}%
  \hspace{0.06\textwidth}\pgfuseimage{\@UNIBASELlogo}%
}

% Frame title and subtitle layout
\setbeamertemplate{frametitle}{%
  \vspace*{-3.5ex}
  \begin{beamercolorbox}[leftskip=2cm]{frametitle}%
    \usebeamerfont{frametitle}\insertframetitle\\
    % \usebeamerfont{framesubtitle}\insertframesubtitle
  \end{beamercolorbox}
}

% -----------------------------------------------------------------------------
% Title page
% -----------------------------------------------------------------------------
\setbeamertemplate{title page}{
  \vskip0pt plus 1filll
  \hspace{-12mm}%
  \begin{beamercolorbox}[wd=0.9\textwidth,sep=10pt,leftskip=8mm]{title}
    {\usebeamerfont{title}\inserttitle}

    {\usebeamerfont{subtitle}\insertsubtitle}

    {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor}

    {\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate}

    % \vspace{6mm}
    % \hspace{5cm}
  \end{beamercolorbox}
  \vfill
  \begin{tikzpicture}[remember picture, overlay]
    \node[anchor=south east, inner sep=5mm] at (current page.south east) {%
      \includegraphics[height=8mm]{images/SNSF_logo}%
    };
  \end{tikzpicture}
}

% Background helpers (kept from original theme)
\newcommand{\TikzSplitSlide}[1]{%
  \rule{0.4\paperwidth}{0pt}%
  \begin{tikzpicture}
    \clip (-0.1\paperwidth,-0.5\paperheight) --
          ( 0.5\paperwidth,-0.5\paperheight) --
          ( 0.5\paperwidth, 0.5\paperheight) --
          ( 0.1\paperwidth, 0.5\paperheight) -- cycle;
    \node at (0.2\paperwidth,0) {%
      \includegraphics[height=\paperheight]{#1}%
    };
  \end{tikzpicture}
}

\newbool{splittitle}
\newcommand{\@TitleBackground}{}
\newcommand{\titlebackground}{\@ifstar{\SplitBackground}{\FullBackground}}
\newcommand{\FullBackground}[1]{\renewcommand{\@TitleBackground}{#1}}
\newcommand{\SplitBackground}[1]{%
  \booltrue{splittitle}%
  \renewcommand{\@TitleBackground}{#1}%
}

\renewcommand{\maketitle}{
\begingroup
  \setbeamertemplate{footline}{}
  \ifdefempty{\@TitleBackground}{}{% Skip if \@TitleBackground is empty
    \setbeamertemplate{background}{%
      \ifbool{splittitle}{%
        \TikzSplitSlide{\@TitleBackground}
      }{% Normal, full-screen background
        \includegraphics[height=\paperheight]{\@TitleBackground}
      }
    }
  }
  \begin{frame}%
      \Large\titlepage%
  \end{frame}%
\endgroup
}

% -----------------------------------------------------------------------------
% Chapter and sidepic environments (unchanged from upstream; colour names updated)
% -----------------------------------------------------------------------------
\newenvironment{chapter}[3][]{% Args: image (optional), color, frame title
  \begingroup
  \themecolor{mint}
  \setbeamertemplate{footline}{}
  \setbeamercolor{frametitle}{fg=unibasWhite}
  \setbeamercolor{normal text}{fg=unibasWhite,bg=#2}
  \ifstrempty{#1}{}{\setbeamertemplate{background}{\TikzSplitSlide{#1}}}
  \setbeamertemplate{frametitle}{%
    \vspace*{8ex}
    \begin{beamercolorbox}[wd=0.45\textwidth]{frametitle}
      \usebeamerfont{frametitle}\insertframetitle\\
      \usebeamerfont{framesubtitle}\insertframesubtitle
    \end{beamercolorbox}
  }
  \begin{frame}{#3}
  \hspace*{0.05\textwidth}%
  \minipage{0.35\textwidth}%
  \usebeamercolor[fg]{normal text}%
}{%
  \endminipage
  \end{frame}
  \endgroup
}

\newenvironment{sidepic}[2]{% Args: image, frame title
  \begingroup
  \setbeamertemplate{background}{%
    \hspace*{0.6\paperwidth}%
    \includegraphics[height=\paperheight]{#1}%
  }
  \begin{frame}{#2}
  \begin{columns}
    \begin{column}{0.55\textwidth}
}{%
    \end{column}
  \end{columns}
  \end{frame}
  \endgroup
}

% -----------------------------------------------------------------------------
% Default motto (can be overridden in user preamble via \UNIBASELmotto{...})
% -----------------------------------------------------------------------------
\newcommand{\@UNIBASELmotto}{University of Basel}
\newcommand{\UNIBASELmotto}[1]{\renewcommand{\@UNIBASELmotto}{#1}}

% Backmatter slide
\newcommand{\backmatter}{%
  \begingroup
  \setbeamertemplate{footline}{}
  \themecolor{mint}
  \begin{frame}[c]
    \centering
    \usebeamerfont{title}\textbf{Thank you.}
  \end{frame}
  \endgroup
}
